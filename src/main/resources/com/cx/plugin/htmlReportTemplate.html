
<style media="screen">
    .mainTitle{
        text-align: center;
        font-size: 50px;
        text-decoration: underline;
    }

    .vulnerabilitiesContainer{
        background-color: #efefef;
        border: 3px solid #b1d241;
        border-radius: 5px;
        width: 75%;
        height: 31%;
        margin-left: auto;
        margin-right: auto;
        text-align: center;

        display: flex;
        flex-direction: column;
    }

    .vulnerabilitiesContainer>h3{
        font-size: 25px;
        margin-left: 30px;
        margin-bottom: 25px;

        position: relative;
        top: -6px;
    }

    .vulnerabilityBarsContainer{
        margin-left: auto;
        margin-right: auto;
        position: relative;
        top: -18px;
        width: 99%;
        height: 80%;

        display: flex;
    }

    .vulnerabilityBar {
        width: 30%;
        margin-left: auto;
        margin-right: auto;
        border-radius: 5px;
        text-align: center;

        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .highBar {
        background-color: #ca0c0c;
    }

    .mediumBar {
        background-color: #ffae02;
    }

    .lowBar {
        background-color: #00b300;
    }

    .barTitle {
        color: white;
        font-size: 3.5vw;
        text-shadow:
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
    }

    .barNumberContainer {
        background-color: white;
        width: 95%;
        height: 60%;
        border: 1px solid black;
        border-radius: 5px;
        margin-left: auto;
        margin-right: auto;

        font-size: 4vw;
        line-height: 130px;

        display: flex;
        flex-direction: column;
    }

    .vulnerabilityNumber{
    }

    .withTooltip .tooltiptext {
        background-color: #484848;
        border-radius: 5px;
        color: white;
        font-size: 25px;
        width: 190px;
        line-height: 40px;
        position: relative;
        top: 25px;
        left: 105px;
    }

    .tooltiptext{
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.6s ease-in-out;
        z-index: 1;
    }

    .withTooltip:hover .tooltiptext{
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
    }


    .withTooltip .tooltiptext::before {
        content: " ";
        position: absolute;
        top: -25%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent #484848 transparent;
    }

    .withTooltip .tooltiptext.exeeded{
        background-color: #ca0c0c;
    }

    .withTooltip .tooltiptext.exeeded::before {
        content: " ";
        position: absolute;
        top: -12%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent #ca0c0c transparent;
    }

    .withTooltip .tooltiptext.exeeded::after{
        content: ' (Exeeded Threshold)';
        font-size: 15px;
    }

    .descriptionsListContainer{
        background-color: #efefef;
        border: 3px solid #b1d241;
        border-radius: 5px;
        width: 74.1%;
        margin-left: auto;
        margin-right: auto;
        position: relative;
        top: 2vh;
        overflow: hidden;
        display: block;
        padding-right: 17px;
    }


    .descriptionListItem{
        font-size: 30px;
        margin-left: 12px;
        margin-top: 5px;
    }

    .descriptionListItem::before{
        content: '- '
    }

    .linkContainer{
        background-color: #efefef;
        border: 3px solid #b1d241;
        border-radius: 5px;
        width: 75%;
        height: 5%;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        font-size: 38px;
        font-weight: bold;
        position: relative;
        top: 4vh;
    }

    .accordionButton{
        width: 101.2%;
        height: 40px;
        font-size: 17px;
        text-align: left;
        font-weight: bold;
        padding-left: 17px;
    }

    .buttonCircle{
        width: 14px;
        height: 14px;
        color: transparent;
        position: relative;
        border-radius: 100%;
        left: -10px;
        top: 10px;

    }

    .highArrListCircle{
        background-color: #ca0c0c;
    }

    .mediumArrListCircle{
        background-color: #ffae02;
    }

    .lowArrListCircle{
        background-color: #00b300;
    }

    .infoArrListCircle{
        background-color: #417dff;
    }

    .buttonText{
        position: relative;
        top: -6px;
        left: 10px;
    }

    .accordionList{
        max-height: 0;
        opacity: 0;
        transition: all 0.7s ease-in-out;
    }

    .vulnerabilityItem a{
        font-size: 21px;
        color: black;
        text-decoration: none;
    }

    .vulnerabilityItem a::before{
        content: '- ';
        text-decoration: none;
    }

    .vulnerabilityItem a:hover{
        text-decoration: underline;
        color: #248ee2;
    }

    .vulnerabilityItem a:visited{
        color: green;
    }

    .vulnerabilityItem a:visited:hover{
        color: #086508;
    }

    .unclick{
        pointer-events: none;
    }

    .accordionList.extended{
        max-height: 2000px;
        opacity: 1;
    }

    .spacer{
        background-color: transparent;
        height: 40px;
        position: relative;
        top: 30px;
    }

</style>

<div class="resultContainer">
    <h1 class="mainTitle">Checkmarx Scan Results</h1>
    <div class="vulnerabilitiesContainer">
        <h3>Vulnerabilities</h3>
        <div class="vulnerabilityBarsContainer">
            <div class="vulnerabilityBar highBar" id="highBar">
                <span class="barTitle">high</span>
                <div class="barNumberContainer withTooltip">
                    <span id="highSum" class="vulnerabilityNumber"></span><!-- high result -->
                    <span id="highThreshold" class='tooltipText'><!-- high threshold --></span>
                </div>
            </div>
            <div class="vulnerabilityBar mediumBar" id="mediumBar">
                <span class="barTitle">medium</span>
                <div class="barNumberContainer withTooltip">
                    <span id="mediumSum" class="vulnerabilityNumber"></span><!-- medium result -->
                    <span id="mediumThreshold" class='tooltipText'><!-- medium threshold --></span>
                </div>
            </div>
            <div class="vulnerabilityBar lowBar" id="lowBar">
                <span class="barTitle">low</span>
                <div class="barNumberContainer withTooltip">
                    <span id="lowSum" class="vulnerabilityNumber"></span><!-- low result -->
                    <span id="lowThreshold" class='tooltipText'><!-- low threshold --></span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="descriptionsListContainer" id="descriptionsListContainer">

</div>
<div class="linkContainer">
    <a id="detailedReport" href="" target="_blank">Detailed Checkmars Report</a>
</div>
<div class="spacer">

</div>
<script type="text/javascript">

    var thresholdsString = '*RESULTS_THRESHOLD*';

    var csv = '*RESULTS_CSV*';
    csv = csv.replace(/ï»¿/g, '');

    /* turn the thresholds string into an array */
    thresholdsString = thresholdsString.split(',');

    /* remove weird chars from csv, and split it into an array */
    var fixedArr = csv.split('~~');

    /* move the properties names from the csv to a string */
    var propArr = fixedArr.shift();

    /* turn the propArr string to an array */
    propArr = propArr.replace(/"/g, '').split(',');

    /* defining the high vulnerabilities array */
    var highArr = [];
        highArr.fullName = 'High Severity Results';
        highArr.shortName = 'highArrList';
        highArr.threshold = Number(thresholdsString[0]);
    /* defining the medium vulnerabilities array */
    var mediumArr = [];
        mediumArr.fullName = 'Medium Severity Results';
        mediumArr.shortName = 'mediumArrList';
        mediumArr.threshold = Number(thresholdsString[1]);
    /* defining the low vulnerabilities array */
    var lowArr = [];
        lowArr.fullName = 'Low Severity Results';
        lowArr.shortName = 'lowArrList';
        lowArr.threshold = Number(thresholdsString[2]);
    /* defining the information array */
    var infoArr = [];
        infoArr.fullName = 'Information Results';
        infoArr.shortName = 'infoArrList';

    /* dividing the vulnerabilities according the risk level (high/medium/low/info) */
    fixedArr.forEach(function(data, index, arr){

        var valueArr = arr[index].replace(/"/g, '').split(',');

        var obj = {};

        valueArr.forEach(function(value, idx, dataArray){
            obj[propArr[idx]] = value;
        })

        switch (obj['Result Severity']){
            case 'High':
                highArr.push(obj);
                break;
            case 'Medium':
                mediumArr.push(obj);
                break;
            case 'Low':
                lowArr.push(obj);
                break;
            case 'Information':
                infoArr.push(obj);
                break;
            default:
                console.log('no severity found in:');
                console.log(obj);
        }
    })

    /* used to fill the accordion lists */
    var allArrs = [highArr, mediumArr, lowArr, infoArr];

    /* used to fill the vulnerabilities sum bars */
    var arraysObj = {
        high: highArr,
        medium: mediumArr,
        low: lowArr
    };

    /* filling the accordion list */
    allArrs.forEach(function(arr, index, allArrays){
        if(arr.length){
            var container = document.createElement('div');
            container.className = arr.shortName;

            var button = document.createElement('button');
            button.className = 'accordionButton';
            button.addEventListener("click", function(){ toggleAccordion(arr.shortName); });
            container.appendChild(button);

            var circle = document.createElement('div');
            circle.className = arr.shortName + 'Circle buttonCircle';
            circle.innerHTML = '.';
            button.appendChild(circle);

            var text = document.createElement('span');
            text.innerHTML = arr.fullName;
            text.className = 'buttonText';
            button.appendChild(text);

            var list = document.createElement('div');
            list.className = 'accordionList';
            list.id = arr.shortName;
            container.appendChild(list);

            arr.forEach(function(element, index, array){

                var newLink = document.createElement('a');
                newLink.href = element.Link;
                newLink.target = '_blank';
                newLink.innerHTML = element.Query;

                var newItem = document.createElement('div');
                newItem.className = 'vulnerabilityItem unclick';
                newItem.appendChild(newLink);

                list.appendChild(newItem);
            })

            document.getElementById('descriptionsListContainer').appendChild(container);
        }
    })

    /* filling the results sum bars */
    for (var array in arraysObj){
    
        var thresholdTooltip;

        if(arraysObj[array].threshold < 0){
            var element = document.getElementById(array + 'Bar');
            element.parentNode.removeChild(element);
        } else {
            document.getElementById(array + 'Sum').innerHTML = arraysObj[array].length;
            thresholdTooltip = document.getElementById(array + 'Threshold');
                thresholdTooltip.innerHTML = 'Threshold is ' + arraysObj[array].threshold;
                if(arraysObj[array].length >= arraysObj[array].threshold){
                    thresholdTooltip.className += ' exeeded';
                }
        }

    }

    /* filling the detailed information link */
    document.getElementById('detailedReport').href = highArr[0].Link.replace(highArr[0].Link.slice(highArr[0].Link.lastIndexOf('&')), '');

    /* open and close the accordoin lists */
    function toggleAccordion(listId){

        var list = document.getElementById(listId);
        var children = list.children;

        if(list.className == 'accordionList'){
            for(var i = 0; i < children.length; ++i){
                children[i].className = 'vulnerabilityItem'
            }
            list.className = 'accordionList extended';
        } else if(list.className == 'accordionList extended') {
            for(var i = 0; i < children.length; ++i){
                children[i].className = 'vulnerabilityItem unclick'
            }
            list.className = 'accordionList';
        }
    }

</script>
